<script src="bower_components/angular-bootstrap-multiselect/dist/angular-bootstrap-multiselect.min.js"></script>
<app-form-header [backButton]="backButton" [title]="title"></app-form-header>
<form (ngSubmit)="onSubmit()" class="os2-form p-3 mt-4">
    <div *ngIf="errorMessages" class="error-messages p-3">
        <ul class="mb-0">
            <li *ngFor="let error of errorMessages">
                {{error}}
            </li>
        </ul>
    </div>

    <div class="row mb-5">
        <div class="form-group mt-3 col-12">
            <label class="form-label" for="name">{{'PERMISSION.EDIT.NAME' | translate}}</label>*
            <input type="text" class="form-control" id="name" name="name"
                [placeholder]="'PERMISSION.EDIT.NAME-PLACEHOLDER' | translate" maxlength="50" required
                [(ngModel)]="permission.name"
                [ngClass]="{'is-invalid' : formFailedSubmit && errorFields.includes('name'), 'is-valid' : formFailedSubmit && !errorFields.includes('name')}">
        </div>
    </div>

    <div class="form-group mt-3 col-12">
        <label class="form-label" for="name">{{'PERMISSION.EDIT.TYPE' | translate}}</label>*
        <select id="level" class="form-select" name="level" [(ngModel)]="permission.level" required
            [value]="permission.organizationId" [disabled]="isEditMode"
            [ngClass]="{'is-invalid' : formFailedSubmit && errorFields.includes('organizationId'), 'is-valid' : formFailedSubmit && !errorFields.includes('organizationId')}"
            placeholder="'PERMISSION.EDIT.TYPE-PLACEHOLDER' | translate">
            <option *ngFor="let level of allowedLevels()" [value]="level" [selected]="level === permission.level">
                {{level}}</option>
        </select>
    </div>

    <div class="form-group mt-3 col-12">
        <label class="form-label" for="name">{{'PERMISSION.EDIT.USERS' | translate}}</label>*
        <div class="col-12">
            <select id="userIds" name="userIds" class="form-control" multiple [(ngModel)]="permission.userIds">
                <option *ngFor="let user of users" [value]="user.id" [selected]="isUserPartOfPermission(user.id)">
                    {{user.name}}</option>
            </select>
        </div>
    </div>
    <!-- <div class="form-group mt-3 col-12">
        <mat-form-field>
            <mat-label class="form-label" for="name">{{'PERMISSION.EDIT.USERS' | translate}}</mat-label>
            <mat-select id="userIds" name="userIds" class="custom-select" multiple [(ngModel)]="permission.userIds"
                [placeholder]="'PERMISSION.EDIT.USERS-PLACEHOLDER' | translate" multiple>
                <mat-option *ngFor="let user of users" [value]="user.id">{{user.name}}</mat-option>
            </mat-select>
        </mat-form-field>
    </div> -->

    <div *ngIf="permission.level != 'GlobalAdmin'">
        <div class="form-group mt-3 col-12">
            <label class="form-label" for="name">{{'PERMISSION.EDIT.ORG' | translate}}</label>*
            <select id="organizationId" class="form-select" name="organizationId"
                [(ngModel)]="permission.organizationId" required [value]="permission.organizationId"
                [disabled]="isEditMode"
                [ngClass]="{'is-invalid' : formFailedSubmit && errorFields.includes('organizationId'), 'is-valid' : formFailedSubmit && !errorFields.includes('organizationId')}"
                (ngModelChange)="organizationChanged($event)">
                <option *ngFor="let org of organisations" [value]="org.id"
                    [selected]="org.id === permission.organizationId">
                    {{org.name}}</option>
            </select>
        </div>
    </div>

    <div *ngIf="isOrganizationAdministrationPermission()">
        <div class="form-group mt-3 col-12">
            <label class="form-label" for="name">{{'PERMISSION.EDIT.APPS' | translate}}</label>*
            <div class="col-12">
                <select id="applicationIds" name="applicationIds" class="form-control" multiple
                    [(ngModel)]="permission.applicationIds"
                    placeholder="'PERMISSION.EDIT.APPS-PLACEHOLDER' | translate">
                    <option *ngFor="let app of applications" [value]="app.id"
                        [selected]="isApplicationPartOfPermission(app.id)">
                        {{app.name}}</option>
                </select>
            </div>
        </div>
    </div>


    <!-- TODO: Select application -->

    <div class="form-group mt-5">
        <button (click)="routeBack()" class="btn btn-light" type="button">{{ 'GEN.CANCEL' | translate}}</button>
        <button class="btn btn-dark ml-2" type="submit">{{ 'PERMISSION.SAVE' | translate}}</button>
    </div>
</form>